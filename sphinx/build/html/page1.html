

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OhmPi V 1.01 (limited to 32 electrodes) &mdash; Ohmpi: open hardware resistivity-meter documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="OhmPi project" href="page0.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Ohmpi:
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="page0.html"><strong>OhmPi project</strong></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">OhmPi V 1.01 (limited to 32 electrodes)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-philosophy-of-ohmpi">The philosophy of Ohmpi</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-data">Technical data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#raspberry-pi-configuration">Raspberry Pi  configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#os-installation">OS installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#virtual-environnement-and-packages">Virtual Environnement and packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#activate-virtual-environnement-on-thonny-python-ide-on-rapberry-pi">Activate virtual environnement on Thonny(Python IDE)  (on Rapberry Pi)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#measurement-and-injection-board-and-connection-to-the-raspberry">Measurement and Injection board and connection to the Raspberry</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#electrical-resistivity-measurements">Electrical resistivity measurements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#current-injection">Current injection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frist-four-electrodes-resistivity-mesurement">Frist four electrodes resistivity mesurement</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiplexer-implentation">Multiplexer implentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#electrode-connection">Electrode connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#operating-instruction">Operating instruction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preliminary-procedure-only-for-the-initial-operation">Preliminary procedure (Only for the initial operation)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#startup-procedure">Startup procedure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#electrical-resistivity-measurement-parameters-description">Electrical resistivity measurement parameters description</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ohmpi:</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>OhmPi V 1.01 (limited to 32 electrodes)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/page1.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ohmpi-v-1-01-limited-to-32-electrodes">
<h1>OhmPi V 1.01 (limited to 32 electrodes)<a class="headerlink" href="#ohmpi-v-1-01-limited-to-32-electrodes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-philosophy-of-ohmpi">
<h2>The philosophy of Ohmpi<a class="headerlink" href="#the-philosophy-of-ohmpi" title="Permalink to this headline">¶</a></h2>
<p>The philosophy of Ohmpi V1.01 is to offer a multi electrode resistivity meter, from a set of commercially available
electronic cards it is a resistivity meter limited to 32 electrodes only. It is limited to low-current injection,
but suitable for small laboratory experiments and small field time monitoring</p>
</div>
<div class="section" id="technical-data">
<h2>Technical data<a class="headerlink" href="#technical-data" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 32%" />
<col style="width: 18%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Parameter</strong></p></td>
<td><p><strong>Specifications</strong></p></td>
<td><p>Units</p></td>
</tr>
<tr class="row-even"><td><p>Electrodes</p></td>
<td><p>32</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Operating temperature</p></td>
<td><p>0 to 50</p></td>
<td><p>°c</p></td>
</tr>
<tr class="row-even"><td><p>Power consumption of CPU and
control system</p></td>
<td><p>18.5</p></td>
<td><p>W</p></td>
</tr>
<tr class="row-odd"><td><p>Voltage injection</p></td>
<td><p>12</p></td>
<td><p>V</p></td>
</tr>
<tr class="row-even"><td><p>Battery</p></td>
<td><p>12</p></td>
<td><p>V</p></td>
</tr>
<tr class="row-odd"><td><p>Current</p></td>
<td><p>0 to 50</p></td>
<td><p>mA</p></td>
</tr>
<tr class="row-even"><td><p>Min pulse duration</p></td>
<td><p>150</p></td>
<td><p>mS</p></td>
</tr>
<tr class="row-odd"><td><p>Input impedance</p></td>
<td><p>36</p></td>
<td><p>Mohm</p></td>
</tr>
<tr class="row-even"><td><p>Data storage</p></td>
<td><p>micro SD card</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Resolution</p></td>
<td><p>O.O1</p></td>
<td><p>ohm</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="raspberry-pi-configuration">
<h2>Raspberry Pi  configuration<a class="headerlink" href="#raspberry-pi-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="os-installation">
<h3>OS installation<a class="headerlink" href="#os-installation" title="Permalink to this headline">¶</a></h3>
<p>The first step is to start up the Raspberry Pi board, including installation of an OS (operating system).
For this step, the installation instructions are well described on the Raspberry website
<a class="reference external" href="https://www.raspberrypi.org/help/noobs-setup/2/">https://www.raspberrypi.org/help/noobs-setup/2/</a>). The authors recommend installing the latest
stable and complete version of Raspbian by using NOOBS (a simple-to-use operating system installer).
Once the OS has been installed, the 1-wire option and GPIO remote option must be deactivated via the
Raspbian GUI settings menu. Failure to carry out this task may cause damage to the relay shield cards during measurements.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the development tests were performed on Raspberry Pi 3 Model B, we used the following version of Raspbian:</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="_images/raspbian_version.jpg"><img alt="alternate text" src="_images/raspbian_version.jpg" style="width: 800px; height: 400px;" /></a>
</div>
</div>
</div>
<div class="section" id="virtual-environnement-and-packages">
<h3>Virtual Environnement and packages<a class="headerlink" href="#virtual-environnement-and-packages" title="Permalink to this headline">¶</a></h3>
<p>All dependencies are specified in requirements.txt</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>all instructions below should be typed in the terminal</p>
</div>
<p>It is first necessary to ensure that the libatlas-base-dev library is installed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libatlas</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<p>We strongly recommend users to create a virtual environment to run the code and installed all required dependencies. It can be done either in a directory gathering all virtual environments used on the computer or within the ohmpy directory.</p>
<p>create the virtual environment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="n">ohmpy</span>
</pre></div>
</div>
<p>activate it using the following command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">ohmpy</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>install packages within the virtual environment. Installing the following package should be sufficient to meet dependencies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">RPi</span><span class="o">.</span><span class="n">GPIO</span> <span class="n">adafruit</span><span class="o">-</span><span class="n">blinka</span> <span class="n">numpy</span> <span class="n">adafruit</span><span class="o">-</span><span class="n">circuitpython</span><span class="o">-</span><span class="n">ads1x15</span> <span class="n">pandas</span>
</pre></div>
</div>
<p>check that requirements are met using</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="nb">list</span>
</pre></div>
</div>
<p>you should run you code within the virtual environment
to leave the virtual environment simply type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">deactivate</span>
</pre></div>
</div>
</div>
<div class="section" id="activate-virtual-environnement-on-thonny-python-ide-on-rapberry-pi">
<h3>Activate virtual environnement on Thonny(Python IDE)  (on Rapberry Pi)<a class="headerlink" href="#activate-virtual-environnement-on-thonny-python-ide-on-rapberry-pi" title="Permalink to this headline">¶</a></h3>
<p>Under developpement</p>
</div>
</div>
<div class="section" id="measurement-and-injection-board-and-connection-to-the-raspberry">
<h2>Measurement and Injection board and connection to the Raspberry<a class="headerlink" href="#measurement-and-injection-board-and-connection-to-the-raspberry" title="Permalink to this headline">¶</a></h2>
<div class="section" id="electrical-resistivity-measurements">
<h3>Electrical resistivity measurements<a class="headerlink" href="#electrical-resistivity-measurements" title="Permalink to this headline">¶</a></h3>
<p>To measure electrical resistivity with Raspberry Pi, an ADS1115 was introduced, as proposed by Florsch [7]. The ADS1115
is a 16-bit ADC (Analog-to-Digital Converter), with an adaptable gain. Its value has been set at 1 in this study. The
input signal value could lie between - to + 6.114 V. The ADS1115 is mounted on a board adapted from an in-house design.
Figure 5 shows the general diagram for the electronic measurement board developed. This figure also displays the test
circuit used to test the board in the laboratory, which mimics the behavior of a soil subjected to current injection.
In this test circuit, resistance R11 represents the soil resistance.
Soil resistance R11 is connected to electrodes A and B for the current injection. Resistors R10 and R12 constitute
the contact resistances between soil and electrodes; they are typically made of stainless steel. The battery, which
allows for direct current injection, is connected in series with resistors R10, R11 and R12. In this part of the board,
resistance R9 has been added to measure the current flowing between electrodes A and B. This resistance value has been
set at 50 ohms in order to ensure:
•       a precise resistance,
•       a resistance less than the sum of resistors R10, R11 and R12; indeed, R10 and R12 generally lie between 100 and 5,000 ohms.
To measure the current intensity between A and B, the electrical potential difference at the pole of the reference resistor (R9)
is measured. The intensity (in mA) is calculated by inserting the resulting value into the following: ?
To measure the potential difference needed to measure current intensity, the ADS 1115 is connected to the ground of the circuit.
In our case, the ground reference is electrode B. The analog inputs A1 and A0 of the ADS1115 are connected to each pole of the
reference resistor (R9). In order to increase input impedance and adapt the signal gain, tracking amplifiers have been included
and completed by a divider bridge (R5, R8, R6 and R7) located between the two amplifiers. The resistance of the divider bridge
ensures that the signal remains between 0 and 5 V, in accordance with the ADS1115 signal gain. To measure the potential difference,
the M and N electrodes are connected to analog inputs A2 and A3 of the ADS 1115. Between the ADC and the electrodes, two tracking
amplifiers and a divider bridge have been positioned so as to obtain a potential lying within the 0-5 V range at the analog input of the ADS 1115.
Let’s note that the potential difference value would equal the potential measured with ADS1115 multiplied by the voltage reduction
value of the divider bridge (see Section 5.2). Despite the use of high-resolution resistance (i.e. accurate to within 1%), it is
still necessary to calibrate the divider bridge using a precision voltmeter. For this purpose, the input and output potentials
of the divider bridge must be measured using an equivalent circuit for various electrical potential values. These values serve
to calculate the gain. With this electronic board, it is possible to measure the potential and intensity without disturbing the
electric field in the ground, with the total input impedance value being estimated at 36 mega-ohms.
A shortcut between Electrodes A and B will generate excessive currents, whose intensities depend on the type of battery used.
A lithium ion battery or automobile-type lead-acid battery can deliver a strong enough current to damage the board and, as such,
constitutes a potential hazard. We therefore recommend adding a 1.5-A fuse between the battery and resistor R9.</p>
<div class="align-center figure" id="id1">
<a class="reference internal image-reference" href="_images/schema_measurement_board.jpg"><img alt="alternate text" src="_images/schema_measurement_board.jpg" style="width: 800px; height: 400px;" /></a>
<p class="caption"><span class="caption-text">Measurement board</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h3>
<p>The measurement board must be printed using the PCB file (Source file repository), with components soldered onto
it by following the steps described below and illustrated in the following figure :</p>
<ul class="simple">
<li><p>Step no. 1: installation of the 1-Kohm resistors with an accuracy of ± 1%.</p></li>
<li><p>Step no. 2: installation of the 1.5-Kohm resistors with an accuracy of ± 1%.</p></li>
<li><p>Step no. 3: installation of both the black female 1 x 10 header and the 7-blue screw terminal blocks</p></li>
<li><p>Step no. 4: installation of the 50-Ohm reference resistor ± 0.1%</p></li>
<li><p>Step no. 5: addition of both the ADS115 directly onto the header (pins must be plugged according to the figure) and the LM358N operational amplifiers (pay attention to the direction).</p></li>
</ul>
<p>1-Kohm and 1.5-Kohm resistors apply to the divider bridge. If, for example, you prefer using a weaker
or stronger power supply, it would be possible to adjust the divider bridge value by simply modifying these resistors.
Once all the components have been soldered together, the measurement board can be connected to the Raspberry Pi and the
battery terminal, according to Figure 9. Between the battery and the TX+ terminal of the measurement board, remember to
place a fuse holder with a 1.5-A fuse for safety purposes.</p>
<div class="align-center figure" id="id2">
<a class="reference internal image-reference" href="_images/measurement_board.jpg"><img alt="alternate text" src="_images/measurement_board.jpg" style="width: 800px; height: 400px;" /></a>
<p class="caption"><span class="caption-text">Measurement circuit board assembly: a) printed circuit board, b) adding the 1-Kohm resistors ± 1%, c)adding the 1.5-Kohm resistors ± 1%, d) adding the black female 1 x 10 header and the 7-blue screw terminal block(2 pin, 3.5-mm pitch), e) adding the 50-ohm reference resistor ± 0.1%, and f) adding the ADS1115 and the LM358N low-power dual operational amplifiers</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="align-center figure" id="id3">
<a class="reference internal image-reference" href="_images/measurement_board-2.jpg"><img alt="alternate text" src="_images/measurement_board-2.jpg" style="width: 800px; height: 700px;" /></a>
<p class="caption"><span class="caption-text">Measurement board installation with Raspberry Pi</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="current-injection">
<h3>Current injection<a class="headerlink" href="#current-injection" title="Permalink to this headline">¶</a></h3>
<p>To carry out the electrical resistivity measurement, the first step consists of injecting current into the ground.
In our case, a simple 12-V lead-acid battery is used to create an electrical potential difference that results
in current circulating into the ground. The current is injected through electrodes A and B (see Fig. 2). This
injection is controlled via a 4-channel relay module board connected to the Raspberry Pi. The mechanical relay
module board is shown in Figure 4. Relays 1 and 2 serve to switch on the current source. The common contacts
of relays 1 and 2 are connected to the positive and negative battery poles, respectively. The normally open
contacts of both relays are connected to the common contacts of relays 3 and 4. Relays 1 and 2 are connected
to the GPIO 7 on the Raspberry Pi and therefore activate simultaneously. The role of relays 3 and 4 is to reverse
the polarity at electrodes A and B. Thus, when relays 3 and 4 are energized by the GPIO 8 in the open position,
the positive battery pole is connected to electrode A and the negative pole to electrode B. When not energized,
they remain in the normally closed position. This set-up offers a simple and robust solution to inject current.</p>
<div class="align-center figure" id="id4">
<a class="reference internal image-reference" href="_images/current_board.jpg"><img alt="alternate text" src="_images/current_board.jpg" style="width: 800px; height: 400px;" /></a>
<p class="caption"><span class="caption-text">Wiring of the 4-channel relay module board for current injection management</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="frist-four-electrodes-resistivity-mesurement">
<h3>Frist four electrodes resistivity mesurement<a class="headerlink" href="#frist-four-electrodes-resistivity-mesurement" title="Permalink to this headline">¶</a></h3>
<p>Under construction describe the way vlide the first part of the instruction.
Electrical resistivity measurement on test circuit</p>
</div>
</div>
<div class="section" id="multiplexer-implentation">
<h2>Multiplexer implentation<a class="headerlink" href="#multiplexer-implentation" title="Permalink to this headline">¶</a></h2>
<p>The resistivity measurement is conducted on four terminals (A, B, M and N). The user could perform each measurement
by manually plugging four electrodes into the four channel terminals. In practice, ERT requires several tens or thousands
of measurements conducted on different electrode arrays. A multiplexer is therefore used to connect each channel to one of
the 32 electrodes stuck into the ground, all of which are connected to the data logger.</p>
<p>We will describe below how to assemble the four multiplexers (MUX), one per terminal. A multiplexer consists of 2 relay
modules with 16 channels each. On the first board, on each MUX, 15 relays out of the 16 available will be used. Please note that the suggested
configuration enables making smaller multiplexers (8 or 16 electrodes only). On the other hand, if you prefer upping to 64 electrodes,
which is entirely possible, a GPIO channel multiplier will have to be used.
To prepare the multiplexer, the channels of the two relay boards must be connected according to the wiring diagram shown below.</p>
<div class="align-center figure" id="id5">
<a class="reference internal image-reference" href="_images/multiplexer_implementation.jpg"><img alt="alternate text" src="_images/multiplexer_implementation.jpg" style="width: 800px; height: 400px;" /></a>
<p class="caption"><span class="caption-text">Schematic diagram of the wiring of two 16-channel relay shields</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>For this purpose, 0.5-mm² cables with end caps are used and their length adjusted for each connection in order to produce a clean assembly.
The length was adjusted so that the distance between the two points to be connected could be directly measured on the board once they had
been assembled one above the other, in adding an extra 3 cm. The wires at the ends need to be stripped and the end caps added.
As a final step, connect the cables to the correct connectors. This operation must be repeated in order to carry out all the wiring shown in Figure below.</p>
<p>Once the operation has been completed, the 16 control pins of each 16-channel relay shield card must be prepared. Each card actually contains 16 input channels
for activating each relay (Fig. 12). However, we will be activating several relays with a single GPIO (to limit the number of GPIOs used on Raspberry Pi,
see Section 2.4). To execute this step, it will be necessary to follow the protocol presented in Figure.</p>
<blockquote>
<div><div class="align-center figure" id="id6">
<a class="reference internal image-reference" href="_images/connection.jpg"><img alt="alternate text" src="_images/connection.jpg" style="width: 800px; height: 400px;" /></a>
<p class="caption"><span class="caption-text">Connection to the 16-channel relay shield</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
</div></blockquote>
<p>For the 16-channel relay shield no. 1, these steps must be followed:
*       Position a test circuit with 10 horizontal and 10 vertical holes on the pins of the 16-channel relay shield board.
*       Follow the diagram and solder the pins as shown in Fig.
*       Lastly, solder 0.5-mm² wires 1 m in length to the test circuit.</p>
<p>For relay shield no. 2, follow the same procedure, but solder all the pins together (d-e-f).
This same operation must be repeated for the other three multiplexers as well.
The next step consists of connecting the relay card inputs to the Raspberry Pi according to Table 5 for all four multiplexers.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 23%" />
</colgroup>
<tbody>
<tr class="row-odd"><td rowspan="2"></td>
<td colspan="4"><p>Relay shield n°1</p></td>
<td><p>Relay Shield n°2</p></td>
</tr>
<tr class="row-even"><td><p>Pin 1</p></td>
<td><p>Pin 2-3</p></td>
<td><p>Pin 4-7</p></td>
<td><p>Pin 8-16</p></td>
<td><p>Pin 1- 16</p></td>
</tr>
<tr class="row-odd"><td><p>Multiplexer A</p></td>
<td><p>12</p></td>
<td><p>16</p></td>
<td><p>20</p></td>
<td><p>21</p></td>
<td><p>26</p></td>
</tr>
<tr class="row-even"><td><p>Multiplexer B</p></td>
<td><p>18</p></td>
<td><p>23</p></td>
<td><p>24</p></td>
<td><p>25</p></td>
<td><p>19</p></td>
</tr>
<tr class="row-odd"><td><p>Multiplexer M</p></td>
<td><p>06</p></td>
<td><p>13</p></td>
<td><p>04</p></td>
<td><p>17</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-even"><td><p>Multiplexer N</p></td>
<td><p>22</p></td>
<td><p>10</p></td>
<td><p>09</p></td>
<td><p>11</p></td>
<td><p>05</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>Connection of the GPIOs to each multiplexer</p>
</div></blockquote>
</div>
<div class="section" id="electrode-connection">
<h2>Electrode connection<a class="headerlink" href="#electrode-connection" title="Permalink to this headline">¶</a></h2>
<p>At this point, all that remains is to connect the electrodes of each multiplexer to a terminal block (Fig. 13). In our set-up, screw terminals assembled on a din rail were used.
According to the chosen multiplexer configuration, all the relays of each multiplexer will be connected to an electrode and, consequently, each electrode will have four incoming
connections. Instead of having four cables connecting an electrode terminal to each multiplexer, we recommend using the cable assembly shown in the following Figure.</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="_images/cable.jpg"><img alt="alternate text" src="_images/cable.jpg" style="width: 800px; height: 300px;" /></a>
</div>
<p>the next figure provides an example of multiplexer relay connections for electrode no. 1: this electrode of multiplexer MUX A must be connected to electrode no. 1 of MUX B. Moreover, electrode no. 1 of MUX B
must be connected to electrode no. 1 of MUX N, which in turn must be connected to electrode no. 1 of MUX M. Lastly, electrode no. 1 of MUX M is connected to the terminal block.
This operation must be repeated for all 32 electrodes.</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="_images/electrode_cable.jpg"><img alt="alternate text" src="_images/electrode_cable.jpg" style="width: 800px; height: 800px;" /></a>
</div>
</div>
<div class="section" id="operating-instruction">
<h2>Operating instruction<a class="headerlink" href="#operating-instruction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="preliminary-procedure-only-for-the-initial-operation">
<h3>Preliminary procedure (Only for the initial operation)<a class="headerlink" href="#preliminary-procedure-only-for-the-initial-operation" title="Permalink to this headline">¶</a></h3>
<p>The open source code must be downloaded at the Open Science Framework source file repository for this manuscript (<a class="reference external" href="https://osf.io/dzwb4/">https://osf.io/dzwb4/</a>)
or at the following Gitlab repository address: <a class="reference external" href="https://gitlab.irstea.fr/reversaal/OhmPi">https://gitlab.irstea.fr/reversaal/OhmPi</a>. The code must be then unzipped into a selected folder (e.g. OhmPi-master). A “readme” file
is proposed in the directory to assist with installation of the software and required python packages. It is strongly recommended to create a python virtual environment for installing
the required packages and running the code.</p>
</div>
<div class="section" id="startup-procedure">
<h3>Startup procedure<a class="headerlink" href="#startup-procedure" title="Permalink to this headline">¶</a></h3>
<p>As an initial operating instruction, the 12-V battery must be disconnected before any hardware handling. Ensure that the battery is charged at full capacity. Plug all the electrodes (32 or fewer)
into the screw terminals. The Raspberry Pi must be plugged into a computer screen, with a mouse and keyboard accessed remotely. The Raspberry Pi must then be plugged into the power supply
(for laboratory measurements) or a power bank (5V - 2A for field measurements). At this point, you’ll need to access the Raspbian operating system. Inside the previously created folder “ohmPi”,
the protocol file “ABMN.txt” must be created or modified; this file contains all quadrupole ABMN numeration (an example is proposed with the source code). Some input parameters of the main “ohmpi.py”
function may be adjusted/optimized depending on the measurement attributes. For example, both the current injection duration and number of stacks can be adjusted. At this point, the 12-V battery can be
plugged into the hardware; the “ohmpi.py” source code must be run within a python3 environment (or a virtual environment if one has been created) either in the terminal or using Thonny. You should now
hear the characteristic sound of a relay switching as a result of electrode permutation. After each quadrupole measurement, the potential difference as well as the current intensity and resistance
are displayed on the screen. A measurement file is automatically created and named “measure.csv”; it will be placed in the same folder.</p>
</div>
<div class="section" id="electrical-resistivity-measurement-parameters-description">
<h3>Electrical resistivity measurement parameters description<a class="headerlink" href="#electrical-resistivity-measurement-parameters-description" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="sd">&quot;&quot;&quot;</span>
<span class="sd"> measurement parameters</span>
<span class="sd"> &quot;&quot;&quot;</span>
 <span class="n">nb_electrodes</span> <span class="o">=</span> <span class="mi">32</span> <span class="c1"># maximum number of electrodes on the resistivity meter</span>
 <span class="n">injection_duration</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="c1"># Current injection duration in second</span>
 <span class="n">nbr_meas</span><span class="o">=</span> <span class="mi">1</span> <span class="c1"># Number of times the quadripole sequence is repeated</span>
 <span class="n">sequence_delay</span><span class="o">=</span> <span class="mi">30</span> <span class="c1"># Delay in seconds between 2 sequences</span>
 <span class="n">stack</span><span class="o">=</span> <span class="mi">1</span> <span class="c1"># repetition of the current injection for each quadripole</span>
</pre></div>
</td></tr></table></div>
<p>The measurement parameters can be adjusted in lines 27 to 30 of the ohmpi.py code.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="page0.html" class="btn btn-neutral float-left" title="OhmPi project" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, INRAE, Rémi CLEMENT

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>